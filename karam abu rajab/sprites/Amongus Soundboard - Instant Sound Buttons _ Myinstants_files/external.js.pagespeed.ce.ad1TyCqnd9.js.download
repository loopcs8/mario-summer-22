var deferredPrompt;var audio=new Audio();audio.preload='none';var hasErrors;var lastUrl;var canPause;function play(url){if(canPause){audio.pause();audio.currentTime=0;}
if(lastUrl!=url||hasErrors){audio.src=url;lastUrl=url;hasErrors=false;canPause=false;audio.addEventListener('error',(error)=>{hasErrors=true});}
var playPromise=audio.play();if(playPromise!==undefined){playPromise.then(_=>{canPause=true;}).catch(error=>{hasErrors=true;});}
if(navigator.vibrate){navigator.vibrate(5);}}
function share(title,instant_url,audio_url){fetch(audio_url).then(r=>r.blob()).then(blobFile=>new File([blobFile],"myinstants.mp3",{type:"audio/mp3"})).then(file=>{navigator.share({files:[file],}).then(()=>{ga('send','event','share','webshare_api_success',instant_url);gtag('event','share',{'type':'web_share','url':instant_url,});});});}
function copyLink(url){var dummy=document.createElement('input');document.body.appendChild(dummy);var url=new URL(url);url.searchParams.set('utm_source','copy');url.searchParams.set('utm_medium','share');dummy.value=url;dummy.select();document.execCommand('copy');document.body.removeChild(dummy);ga('send','event','share','copy_link',url.toString());gtag('event','share',{'type':'copy_link','url':url.toString(),});return false;}
function copyEmbed(){var textarea=document.getElementById('instant-embed');textarea.select();document.execCommand('copy');ga('send','event','embed','click',window.location.toString());gtag('event','embed_copied',{'url':window.location.toString(),});return false;}
function install(platform){if(deferredPrompt){deferredPrompt.prompt();deferredPrompt.userChoice.then((choiceResult)=>{if(choiceResult.outcome==='accepted'){ga('send','event','WebAppInstall','installed_banner_'+platform);gtag('event','webapp_installed',{'location':platform,});}else{ga('send','event','WebAppInstall','dismissed_banner_'+platform);gtag('event','webapp_dismissed',{'location':platform,});}
deferredPrompt=null;});}}
async function favorite(instant_id){fetch(`/api/v1/favorite/add/${instant_id}/`).then(response=>{console.log(response);if(response.status==200){ga('send','event','favorites','favorite_add',`${instant_id}`);gtag('event','favorite_add',{'instant_id':`${instant_id}`,});}else if(response.status==401){window.location=`/accounts/login/?next=${window.location}`;}});}
function setNavbarUser(){var usernameCookie=document.cookie.split('; ').find(row=>row.startsWith('username='));if(usernameCookie){var username=usernameCookie.split('=')[1];var navLogin=document.getElementById('nav-login');navLogin.innerHTML=`<img src="/media/images/icons/account.svg" alt="User account icon" class="nav-icon-left" width="24" height="24">${username}`;navLogin.classList.add('dropdown-toggle');navLogin.href='#';navLogin.setAttribute('data-bs-toggle','dropdown');}}
function setInstallButtons(){var btnAddDesktop=document.getElementById("install-app-desktop");var btnAddInstantPage=document.getElementById("install-app-instant-page");var btnAddNav=document.getElementById("install-app-nav");if(navigator.standalone||window.matchMedia('(display-mode: standalone)').matches){btnAddDesktop.classList=['d-none'];if(btnAddInstantPage){btnAddInstantPage.classList=['d-none'];}
if(btnAddNav){btnAddNav.classList=['d-none'];}}
window.addEventListener('beforeinstallprompt',function(e){e.preventDefault();deferredPrompt=e;if(!(navigator.standalone||window.matchMedia('(display-mode: standalone)').matches)){btnAddDesktop.classList.remove('invisible');if(btnAddInstantPage){btnAddInstantPage.classList.remove('invisible');}
if(btnAddNav){btnAddNav.classList.remove('invisible');}}
return false;});window.addEventListener('appinstalled',(event)=>{ga('send','event','WebAppInstall','installed_total');gtag('event','webapp_installed_total');});btnAddDesktop.addEventListener('click',(e)=>{install('desktop');});if(btnAddInstantPage){btnAddInstantPage.addEventListener('click',(e)=>{install('instant_page');});}
if(btnAddNav){btnAddNav.addEventListener('click',(e)=>{install('nav');});}}
function hideWebShareIfNotSupported(){if(!navigator.canShare||!navigator.canShare({files:[new File(["foo"],"foo.mp3",{type:"audio/mp3"})]})){document.querySelectorAll('.webshare').forEach(function(el){el.style.display='none';});}}
function showSearchBar(){var installBtn=document.getElementById('install-app-nav');installBtn.classList=['d-none'];var searchBtn=document.getElementById('btn-search');searchBtn.classList=['d-none'];var brand=document.getElementById('brand');brand.classList=['d-none'];var searchbar=document.getElementById('searchbar');searchbar.classList.remove('d-none');searchbar.classList.remove('d-md-flex');searchbar.focus();document.querySelector('#searchbar > div > input').focus();}
window.addEventListener('load',function(){var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));var tooltipList=tooltipTriggerList.map(function(tooltipTriggerEl){var tooltip=new bootstrap.Tooltip(tooltipTriggerEl);tooltipTriggerEl.addEventListener('show.bs.tooltip',function(){setTimeout(function(){tooltip.hide();},1000);});return tooltip;})});if(document.readyState!=='loading'){hideWebShareIfNotSupported();setNavbarUser();setInstallButtons();}else{document.addEventListener('DOMContentLoaded',function(){hideWebShareIfNotSupported();setNavbarUser();setInstallButtons();});}